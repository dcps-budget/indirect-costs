---
title: "Categorize Non-Personnel"
format: html
---

```{r}
library(tidyverse)
library(glue)
library(janitor)
library(readxl)
library(writexl)

options(scipen = 12, digits = 12)
```

Setup

```{r}
path_data <- glue(
  "C:/Users",
  "{Sys.getenv('USERNAME')}",
  "OneDrive - District of Columbia Public Schools",
  "Data",
  .sep = "/"
)

path_working <- glue(
  "C:/Users",
  "{Sys.getenv('USERNAME')}",
  "OneDrive - District of Columbia Public Schools",
  "Working Files - Indirect Cost",
  .sep = "/"
)
```

```{r}
nonpersonnel <- 
  read_excel("data/nonpersonnel.xlsx", col_types = "text") %>% 
  mutate(across(net_accounted, \(x) round(as.numeric(x), 2)))

props_costcenter <- read_excel("data/props_costcenter.xlsx")

accounts <-
  read_excel(
    glue("{path_working}/Categorization - Account.xlsx")
  ) %>%
  select(!c(account_desc, is_always_direct, is_always_indirect))
```

```{r}
nonpersonnel_categorized <-
  nonpersonnel %>%
  left_join(accounts, by = join_by(account)) %>%
  left_join(props_costcenter, by = join_by(costcenter_clean)) %>% 
  mutate(
    amt_direct = round(net_accounted * prop_direct, 2),
    amt_indirect = round(net_accounted * prop_indirect, 2)
  )

nonpersonnel_categorized
```

```{r}
nonpersonnel_categorized %>% write_xlsx("data/nonpersonnel_categorized.xlsx")
```
